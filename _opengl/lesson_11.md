---
title: 'UV-–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è —Å—Ñ–µ—Ä—ã'
---

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã –æ—Å–≤–æ–∏–º –∞–ø–ø—Ä–æ–∫—Å–∏–º–∞—Ü–∏—é —Å—Ñ–µ—Ä—ã —Å–µ—Ç–∫–æ–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤, –∏ –∏–∑—É—á–∏–º –æ–±—â–∏–π —Å–ø–æ—Å–æ–± —Ä–∏—Å–æ–≤–∞–Ω–∏—è —Ç–µ–ª –≤—Ä–∞—â–µ–Ω–∏—è. –¢–∞–∫–∂–µ –º—ã –Ω–∞–ª–æ–∂–∏–º —Ç–µ–∫—Å—Ç—É—Ä—ã –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –∏ —Å–æ–∑–¥–∞–¥–∏–º SkyBox.

## –°–ø–æ—Å–æ–±—ã —Ä–∏—Å–æ–≤–∞–Ω–∏—è —Å—Ñ–µ—Ä—ã

–ß—Ç–æ–±—ã –∞–ø–ø—Ä–æ–∫—Å–∏–º–∏—Ä–æ–≤–∞—Ç—å —Å—Ñ–µ—Ä—É —Ç—Ä–µ—É–≥–æ–ª—å–Ω–æ–π —Å–µ—Ç–∫–æ–π, –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:

- –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–µ—Ç–∫–∏
- –≤—ã—á–∏—Å–ª–∏—Ç—å –≤–µ—Ä—à–∏–Ω—ã —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤ –∏ –∞—Ç—Ä–∏–±—É—Ç—ã –≤–µ—Ä—à–∏–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–æ—Ä–º–∞–ª–∏)
- –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—à–∏–Ω—ã, —Å–æ—Å—Ç–∞–≤–∏–≤ –∏–∑ –Ω–∏—Ö –ø–æ–ª–æ—Å—É —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤

–û–¥–∏–Ω –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è —Å—Ñ–µ—Ä—ã &mdash; —ç—Ç–æ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∏–∫–æ—Å–∞—ç–¥—Ä–∞. –°—Ä–µ–¥–∏ –≤—Å–µ—Ö –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ü–ª–∞—Ç–æ–Ω–æ–≤—ã—Ö —Ç–µ–ª –∏–∫–æ—Å–∞—ç–¥—Ä –±–ª–∏–∂–µ –≤—Å–µ–≥–æ –∫ —Å—Ñ–µ—Ä–µ, –∫—Ä–æ–º–µ —Ç–æ–≥–æ, –µ–≥–æ –≥—Ä–∞–Ω–∏ —É–∂–µ —è–≤–ª—è—é—Ç—Å—è —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞–º–∏. –ö–∞–∂–¥–∞—è –≥—Ä–∞–Ω—å –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ 3 –ø–æ–¥–≥—Ä–∞–Ω–∏: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∏–∑ —ç—Ç–æ–π –≥—Ä–∞–Ω–∏ –∏ —Ç–æ—á–∫–∏ –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ —Å—Ñ–µ—Ä—ã —Ç–µ—Ç—Ä–∞—ç–¥—Ä, –∞ –ø–æ—Ç–æ–º –≤–∑—è—Ç—å —Ç—Ä–∏ –¥—Ä—É–≥–∏—Ö –≥—Ä–∞–Ω–∏ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ —Ç–µ—Ç—Ä–∞—ç–¥—Ä–∞, –∞ –∏–∑–Ω–∞—á–∞–ª—å–Ω—É—é –≥—Ä–∞–Ω—å –æ—Ç–±—Ä–æ—Å–∏—Ç—å.

–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∏–∫–æ—Å–∞—ç–¥—Ä–∞ —è–≤–ª—è–µ—Ç—Å—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω—ã–º, –Ω–æ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±: –Ω–∞–º –ø—Ä–∏–¥—ë—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á—É —Ç—Ä–∏–∞–Ω–≥—É–ª—è—Ü–∏–∏ –∏–∫–æ—Å–∞—ç–¥—Ä–∞, –∞ –ø–æ—Ç–æ–º –µ—ë –∏ –∑–∞–¥–∞—á—É –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –≥—Ä–∞–Ω–µ–π. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, —Ç–∞–∫–æ–π —Å–ø–æ—Å–æ–± –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ª—é–±—ã—Ö –¥—Ä—É–≥–∏—Ö —Ç–µ–ª, –∫—Ä–æ–º–µ —Å—Ñ–µ—Ä—ã. –û–¥–Ω–∞–∫–æ, –µ—Å—Ç—å –±–æ–ª–µ–µ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ UV-–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–∏, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ –º–æ–∂–Ω–æ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –ª—é–±–æ–µ —Ç–µ–ª–æ –≤—Ä–∞—â–µ–Ω–∏—è.

[–¢–µ–ª–∞ –≤—Ä–∞—â–µ–Ω–∏—è](https://ru.wikipedia.org/wiki/%D0%A2%D0%B5%D0%BB%D0%B0_%D0%B2%D1%80%D0%B0%D1%89%D0%B5%D0%BD%D0%B8%D1%8F) –º–æ–≥—É—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã –ø—É—Ç—ë–º –≤—Ä–∞—â–µ–Ω–∏—è –Ω–µ–∫–æ—Ç–æ—Ä–æ–π —Ñ–∏–≥—É—Ä—ã, —Å–æ—Å—Ç–æ—è—â–µ–π –∏–∑ –∫—Ä–∏–≤–æ–π –∏ –æ—Ç—Ä–µ–∑–∫–∞ –ø—Ä—è–º–æ–π, –≤–æ–∫—Ä—É–≥ –µ—ë –ø—Ä—è–º–æ–π —Å—Ç–æ—Ä–æ–Ω—ã:

![–ê–Ω–∏–º–∞—Ü–∏—è](figures/revolution_body.png)

UV –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è –≤–≤–æ–¥–∏—Ç –¥–≤–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞, "u" –∏ "v". –ü–∞—Ä–∞–º–µ—Ç—Ä "u" —Å–æ–∑–¥–∞—ë—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ "–º–µ—Ä–∏–¥–∏–∞–Ω–µ" —Ç–µ–ª–∞ –≤—Ä–∞—â–µ–Ω–∏—è &mdash; —Ç–æ –µ—Å—Ç—å –Ω–∞ –ª–∏–Ω–∏–∏, –ø—Ä–æ—Ö–æ–¥—è—â–µ–π –≤–¥–æ–ª—å –æ—Å–∏ –≤—Ä–∞—â–µ–Ω–∏—è —Ç–µ–ª–∞. –ü–∞—Ä–∞–º–µ—Ç—Ä "v" —Å–æ–∑–¥–∞—ë—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ "–ø–∞—Ä–∞–ª–ª–µ–ª–∏", —Ç–æ –µ—Å—Ç—å –Ω–∞ –ª–∏–Ω–∏–∏, –æ–±–æ—Ä–∞—á–∏–≤–∞—é—â–µ–π —Ç–µ–ª–æ –≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–¥–æ–±–Ω–æ —ç–∫–≤–∞—Ç–æ—Ä—É –∏–ª–∏ –ø–∞—Ä–∞–ª–ª–µ–ª–∏ –≥–ª–æ–±—É—Å–∞.

## UV-–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è —Å—Ñ–µ—Ä—ã

–í –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ –ø—Ä–∏–Ω—è—Ç–æ —Ä–∞–∑–¥–µ–ª—è—Ç—å –≥–ª–æ–±—É—Å –¥–≤—É–º—è —Ç–∏–ø–∞–º–∏ –ª–∏–Ω–∏–π &mdash; –ø–∞—Ä–∞–ª–ª–µ–ª—è–º–∏ (–ø–∞—Ä–∞–ª–ª–µ–ª—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —à–∏—Ä–æ—Ç–æ–π) –∏ –º–µ—Ä–∏–¥–∏–∞–Ω–∞–º–∏ (–º–µ—Ä–∏–¥–∏–∞–Ω —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –¥–æ–ª–≥–æ—Ç–æ–π).

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è](figures/meridian.png)

–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ —Ö–æ—Ä–æ—à–æ —Å–æ—á–µ—Ç–∞–µ—Ç—Å—è —Å UV-–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–µ–π: –º—ã –±—É–¥–µ–º –¥–µ–ª–∏—Ç—å —Å—Ñ–µ—Ä—É —Ç–∞–∫ –∂–µ, –∫–∞–∫ –ø–∞—Ä–∞–ª–ª–µ–ª–∏ –∏ –º–µ—Ä–∏–¥–∏–∞–Ω—ã –¥–µ–ª—è—Ç –≥–ª–æ–±—É—Å, –∏ –æ–±–æ–∑–Ω–∞—á–∏–º —à–∏—Ä–æ—Ç—É –∫–∞–∫ "œÜ", –∞ –¥–æ–ª–≥–æ—Ç—É –∫–∞–∫ "Œª". –°–¥–µ–ª–∞–≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–π –∏ –ø—Ä–∏–º–µ–Ω–∏–≤ —Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞, –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ñ–æ—Ä–º—É–ª—ã, –≤—ã–≤–æ–¥—è—â–∏–µ —Ç—Ä—ë—Ö–º–µ—Ä–Ω—ã–π –≤–µ–∫—Ç–æ—Ä (x, y, z) –∏–∑ –¥–≤—É–º–µ—Ä–Ω–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞ (u, v):

![–°—Ö–µ–º–∞](figures/uv_sphere.png)

–ü–æ–ª—É—á–µ–Ω–Ω—ã–π –Ω–∞–º–∏ —Å–ø–æ—Å–æ–± —Ç—Ä–∏–∞–≥—É–ª—è—Ü–∏–∏ –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—é –≥—Ä–∞—Ñ–∏–∫–∞ –¥–≤—É–º–µ—Ä–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞. –¢–æ–ª—å–∫–æ —Ç–µ–ø–µ—Ä—å –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è (x, z) –∏ –≤—ã–≤–æ–¥–∞ –∏–∑ –Ω–∏—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã "y" –º—ã –≤–≤–æ–¥–∏–º —Å–µ—Ç–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (u, v) –∏ –≤—ã–≤–æ–¥–∏–º –∏–∑ –Ω–∏—Ö (x, y, z)

## –ö–ª–∞—Å—Å CIdentitySphere

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ –≤ —Ü–µ–ª–æ–º –ø–æ—Ö–æ–∂–µ –Ω–∞ CSolidFunctionSurface –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–∞—Ç—å–∏, –Ω–æ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä CIdentitySphere –ø—Ä–µ–¥–∞—ë—Ç—Å—è —á–∏—Å–ª–æ –¥–µ–ª–µ–Ω–∏–π –ø–æ –ø–∞—Ä–∞–ª–ª–µ–ª—è–º –∏ –ø–æ –º–µ—Ä–∏–¥–∏–∞–Ω–∞–º —Å—Ñ–µ—Ä—ã, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ñ–µ—Ä—ã –ø—Ä–∏ –µ—ë –∫–æ–Ω—Å—Ç—Ä—É–∏—Ä–æ–≤–∞–Ω–∏–∏.

```cpp
// –í–µ—Ä—à–∏–Ω–∞ —Å —Ç—Ä—ë—Ö–º–µ—Ä–Ω–æ–π –ø–æ–∑–∏—Ü–∏–µ–π –∏ –Ω–æ—Ä–º–∞–ª—å—é.
struct SVertexP3N
{
    glm::vec3 position;
    glm::vec3 normal;
};

class CIdentitySphere final : public IBody
{
public:
    CIdentitySphere(unsigned slices, unsigned stacks);

    void Update(float) final {}
    void Draw()const final;

private:
    void Tesselate(unsigned slices, unsigned stacks);—á

    std::vector<SVertexP3N> m_vertices;
    std::vector<uint32_t> m_indicies;
};
```

–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ CalculateTriangleStripIndicies (–¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–µ—Ä—à–∏–Ω –ø–æ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–º) –∏ DoWithBindedArrays (–¥–ª—è –ø—Ä–∏–≤—è–∑–∫ –º–∞—Å—Å–∏–≤–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∫ OpenGL) –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å –ø—Ä–æ—à–ª—ã–º –ø—Ä–∏–º–µ—Ä–æ–º. –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –∏ –º–µ—Ç–æ–¥–∞ Draw –ø—Ä–æ—Å—Ç—ã:

```cpp
CIdentitySphere::CIdentitySphere(unsigned slices, unsigned stacks)
{
    Tesselate(slices, stacks);
}

void CIdentitySphere::Draw() const
{
    DoWithBindedArrays(m_vertices, [this] {
        glDrawElements(GL_TRIANGLE_STRIP, GLsizei(m_indicies.size()),
                       GL_UNSIGNED_INT, m_indicies.data());
    });
}
```

–í –º–µ—Ç–æ–¥–µ Tesselate —Ç–µ–ø–µ—Ä—å –≤–º–µ—Å—Ç–æ –∏—Ç–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ `(x,z)` –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è `y` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏—Ç–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º `(u,v)` –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã (latitude), –¥–æ–ª–≥–æ—Ç—ã (longitude), –∞ –∑–∞—Ç–µ–º –∏ –ø–æ–∑–∏—Ü–∏–∏ –≤–µ—Ä—à–∏–Ω—ã `(x,y,z)`. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –Ω–æ—Ä–º–∞–ª–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–µ–≥–∫–æ, —Ç–∞–∫ –∫–∞–∫ —Ä–∞–¥–∏—É—Å, –ø—Ä–æ–≤–µ–¥—ë–Ω–Ω—ã–π –∫ —Ç–æ—á–∫–µ —Å—Ñ–µ—Ä—ã, —É–∂–µ –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–µ–Ω –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏, –∞ –≤ –µ–¥–∏–Ω–∏—á–Ω–æ–π —Å—Ñ–µ—Ä–µ —Ä–∞–¥–∏—É—Å –µ—â—ë –∏ —Ä–∞–≤–µ–Ω –µ–¥–∏–Ω–∏—Ü–µ (—Ç.–µ. –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏); —ç—Ç–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–æ–∏–ª–ª—é—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ:

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è](figures/sphere_normal_vectors.png)

```cpp
void CIdentitySphere::Tesselate(unsigned slices, unsigned stacks)
{
    assert((slices >= MIN_PRECISION) && (stacks >= MIN_PRECISION));
    m_vertices.reserve(slices * stacks);
    // –≤—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –≤–µ—Ä—à–∏–Ω.
    for (unsigned ci = 0; ci < slices; ++ci)
    {
        const float u = float(ci) / float(slices - 1);
        for (unsigned ri = 0; ri < stacks; ++ri)
        {
            const float v = float(ri) / float(stacks - 1);

            SVertexP3N vertex;
            vertex.position = GetPositionOnSphere(u, v);

            // –ù–æ—Ä–º–∞–ª—å –∫ —Å—Ñ–µ—Ä–µ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä —Ä–∞–¥–∏—É—Å–∞ –∫ –¥–∞–Ω–Ω–æ–π —Ç–æ—á–∫–µ
            // –ü–æ—Å–∫–æ–ª—å–∫—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞ —Ä–∞–≤–Ω—ã 0, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–µ–∫—Ç–æ—Ä–∞ —Ä–∞–¥–∏—É—Å–∞
            // –±—É–¥—É—Ç —Ä–∞–≤–Ω—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º –≤–µ—Ä—à–∏–Ω—ã.
            // –ë–ª–∞–≥–æ–¥–∞—Ä—è —Ä–∞–¥–∏—É—Å—É, —Ä–∞–≤–Ω–æ–º—É 1, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
            vertex.normal = vertex.position;

            m_vertices.push_back(vertex);
        }
    }

    CalculateTriangleStripIndicies(m_indicies, slices, stacks);
}
```

–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è GetPositionOnSphere() –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º `(u,v)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –≤–µ—Ä—à–∏–Ω—ã –Ω–∞ –µ–¥–∏–Ω–∏—á–Ω–æ–π —Å—Ñ–µ—Ä–µ, —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞–Ω–µ–µ —Å–¥–µ–ª–∞–Ω–æ–º—É –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—é:

```cpp
glm::vec3 GetPositionOnSphere(float u, float v)
{
    const float radius = 1.f;
    const float latitude = float(M_PI) * (1.f - v); // ÌùÖ‚àô(Ìüé.Ìüì-Ìíó)
    const float longitude = float(2.0 * M_PI) * u; // ÌüêÌùÖ‚àôÌíñ
    const float latitudeRadius = radius * sinf(latitude);

    return { cosf(longitude) * latitudeRadius,
             cosf(latitude) * radius,
             sinf(longitude) * latitudeRadius };
}
```

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ñ–µ—Ä—ã –≤ –∫–ª–∞—Å—Å —Å—Ü–µ–Ω—ã —Å –±–µ–ª—ã–º –º–∞—Ç–µ—Ä–∏–∞–ª–æ–º –º—ã –ø–æ–ª—É—á–∞–µ–º:

![–°–∫—Ä–∏–Ω—à–æ—Ç](figures/uv_sphere_rendered.png)

## –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞–∫ —Ç–µ–∫—Å—Ç—É—Ä—ã

–ù–∞—Å—Ç–∞–ª–æ –≤—Ä–µ–º—è —É–∫—Ä–∞—Å–∏—Ç—å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å —Å—Ñ–µ—Ä—ã —Ç–µ–∫—Å—Ç—É—Ä–æ–π. –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –º—ã –≤–æ–∑—å–º—ë–º —Ç–µ–∫—Å—Ç—É—Ä—É –ó–µ–º–ª–∏:

![–¢–µ–∫—Å—Ç—É—Ä–∞](figures/daily_earth.png)

–í OpenGL —Ç–µ–∫—Å—Ç—É—Ä—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∏–¥–µ–æ–ø–∞–º—è—Ç–∏, –∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–º –∫–∞–∫ –º–∞—Å—Å–∏–≤—ã –ø–∏–∫—Å–µ–ª–µ–π —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ [glTexImage2D](https://www.opengl.org/sdk/docs/man2/xhtml/glTexImage2D.xml). –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –º–∞—Å—Å–∏–≤ –ø–∏–∫—Å–µ–ª–µ–π –∏–∑ —Ñ–∞–π–ª–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ SDL2, –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—ä–µ–∫—Ç [SDL_Surface](http://wiki.libsdl.org/SDL_Surface). –°–¥–µ–ª–∞—Ç—å —ç—Ç–æ –º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:

- —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ [SDL_LoadBMP](http://wiki.libsdl.org/SDL_LoadBMP) –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ BMP
- –º—ã –º–æ–∂–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å [SDL_image](http://www.libsdl.org/projects/SDL_image/) –∏ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö PNG, JPEG, WEBP –∏ TIFF —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ [IMG_Load](https://www.libsdl.org/projects/SDL_image/docs/SDL_image_frame.html)

–§–æ—Ä–º–∞—Ç BMP –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∫–∞–∫ –Ω–µ —Å–∂–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø–∏–∫—Å–µ–ª—è—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: –ø—Ä–∏ —Ä–∞–∑–º–µ—Ä–µ 1000x1000 –∏ —Ñ–æ—Ä–º–∞—Ç–µ –ø–∏–∫—Å–µ–ª–µ–π RGBA —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –±—É–¥–µ—Ç –ø–æ—Ä—è–¥–∫–∞ 4–ú–ë (–∏–ª–∏ —á—É—Ç—å –º–µ–Ω—å—à–µ –≤ —Ä–µ–∂–∏–º–µ RLE encoding). –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–∞—Å—Ç–æ–ª—å–∫–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SDL_image: –¥–ª—è —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –∞—Ä—Ö–∏–≤ –∏ —Å–æ–≤–º–µ—Å—Ç–∏—Ç—å –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–∏ include, lib, bin —Å –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–∞–º–∏ —Ä–∞–Ω–µ–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ SDL2.

–ù–∞–º –Ω—É–∂–Ω–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ —Ç–µ–∫—Å—Ç—É—Ä—É –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å. –ë–ª–∞–≥–æ–¥–∞—Ä—è —Å–ª–µ–¥–æ–≤–∞–Ω–∏—é –ø—Ä–∞–≤–∏–ª–∞–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ C++ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é —É–º–Ω—ã—Ö —É–∫–∞–∑–∞—Ç–µ–ª–µ–π, –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏ –Ω–µ –±–æ—è—Ç—å—Å—è —É—Ç–µ—á–µ–∫ —Ä–µ—Å—É—Ä—Å–æ–≤. –î–æ–±–∞–≤–∏–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Ñ–∞—Ç–∞–ª—å–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ main:

#### main.cpp

```cpp
#include "stdafx.h"
#include "Window.h"
#include <SDL2/SDL.h>

namespace
{
const glm::ivec2 WINDOW_SIZE = {800, 600};
const char WINDOW_TITLE[] = "OpenGL Demo #11 (skybox + earth)";
const char ERROR_TITLE[] = "Fatal Error";
}

int main(int, char *[])
{
    try
    {
        CWindow window;
        window.Show(WINDOW_TITLE, WINDOW_SIZE);
        window.DoGameLoop();
    }
    catch (const std::exception &ex)
    {
        SDL_ShowSimpleMessageBox(SDL_MESSAGEBOX_ERROR, ERROR_TITLE,
                                 ex.what(), nullptr);
    }

    return 0;
}
```

## –ö–ª–∞—Å—Å CFilesystemUtils

–≠—Ç–æ—Ç –∫–ª–∞—Å—Å –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ –æ—Å–Ω–æ–≤–µ Boost.Filesystem. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –∫–ª–∞—Å—Å –∑–∞–π–º—ë—Ç—Å—è –ø–æ–∏—Å–∫–æ–º —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º –ø—É—Ç—è–º. –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞:

```cpp
#pragma once
#include "Utils.h"
#include <string>
#include <boost/filesystem/path.hpp>

class CFilesystemUtils
{
public:
    CFilesystemUtils() = delete;

    static boost::filesystem::path GetResourceAbspath(const boost::filesystem::path &path);
    static std::string LoadFileAsString(const boost::filesystem::path &path);
    static SDLSurfacePtr LoadImage(const boost::filesystem::path &path);
};
```

–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –º–æ–∂–Ω–æ –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:

- –µ—Å–ª–∏ –≤—ã –∑–Ω–∞–µ—Ç–µ —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –æ—Ç—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ —Ä–µ—Å—É—Ä—Å–æ–≤, —Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `boost::filesystem::absolute(relativePath, rootDir)`
- –µ—Å–ª–∏ –≤—ã –Ω–µ –∑–Ω–∞–µ—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ –∏ –≤–æ—Å–ø–æ–ª—å–∑—É–µ—Ç–µ—Å—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º –ø—É—Ç—ë–º, —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ —Ä–∞–∑–≤–µ—Ä–Ω—ë—Ç –ø—É—Ç—å —Å —É—á—ë—Ç–æ–º —Ç–µ–∫—É—â–µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ (—Å–º. [Working Directory –Ω–∞ en.wikipedia.org](https://en.wikipedia.org/wiki/Working_directory)) –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã.

–ü—É—Ç—å –∫ —Ç–µ–∫—É—â–µ–º—É –∫–∞—Ç–∞–ª–æ–≥—É —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏, –æ–¥–Ω–∞–∫–æ, –Ω–æ–≤–∏—á–∫–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ —á–∞—Å—Ç–æ –ø—É—Ç–∞—é—Ç—Å—è. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –≤—ã–±–æ—Ä —ç—Ç–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ö—É–¥–∞ –Ω–∞–¥—ë–∂–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—É—Ç—å –∫ –∫–∞—Ç–∞–ª–æ–≥—É, –≤ –∫–æ—Ç–æ—Ä–æ–º –ª–µ–∂–∏—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –ø—Ä–æ–≥—Ä–∞–º–º—ã.

–ú—ã –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—É—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É —Ñ–∞–π–ª–∞ –Ω–∞ Windows, Linux –∏ MacOSX, –∏—Å–ø–æ–ª—å–∑—É—è API –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã:

```cpp
#include <boost/filesystem/operations.hpp>
#ifdef _WIN32
#include <sdkddkver.h>
#include <Windows.h>
#endif

const size_t FILE_RESERVE_SIZE = 4096;
const size_t MAX_PATH_SIZE = 4096;

// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Ç—å –∫ —Ç–µ–∫—É—â–µ–º—É –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É —Ñ–∞–π–ª—É,
// .exe –Ω–∞ Windows, ELF –Ω–∞ Linux, MachO –Ω–∞ MacOSX
std::string GetExecutablePath()
{
    char buffer[MAX_PATH_SIZE];
    size_t size = sizeof(buffer);
#if defined(_WIN32)
    size = size_t(::GetModuleFileNameA(nullptr, buffer, DWORD(size)));
#elif defined(__linux__)
    ssize_t result = readlink("/proc/self/exe", buffer, size);
    if (result <= 0)
    {
        throw std::runtime_error("Unexpected error on readlink()");
    }
    size = size_t(result);
#elif defined(__apple__)
    uint32_t sizeU32 = uint32_t(size);
    if (_NSGetExecutablePath(buffer, &sizeU32) != 0)
    {
        throw std::runtime_error("Unexpected error on _NSGetExecutablePath()");
    }
    size = size_t(sizeU32);
#endif
    return std::string(buffer, size_t(size));
}
```

–ü–æ–ª—É—á–µ–Ω–Ω—ã–π –ø—É—Ç—å –º–æ–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –æ–±—ä–µ–∫—Ç `boost::filesystem::path`, –∏ –∑–∞—Ç–µ–º –ø–æ–ª—É—á–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è —ç—Ç–æ–≥–æ –ø—É—Ç–∏ –º–µ—Ç–æ–¥–æ–º `.parent_path()`. –ï—Å–ª–∏ –º—ã –¥–æ–±–∞–≤–∏–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—É—Ç–∏, —Ç–æ –º—ã –º–æ–∂–µ–º –Ω–∞–ø–∏—Å–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞ CFilesystemUtils, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø—É—Ç—å (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å.

```cpp
namespace fs = boost::filesystem;

boost::filesystem::path CFilesystemUtils::GetResourceAbspath(const boost::filesystem::path &currentPath)
{
    if (currentPath.is_absolute())
    {
        return currentPath;
    }

    const fs::path executableDir = fs::path(GetExecutablePath()).parent_path();
    const fs::path currentDir = fs::current_path();
    for (const auto &dir : {executableDir, currentDir})
    {
        fs::path abspath = fs::absolute(currentPath, dir);
        if (fs::exists(abspath))
        {
            return abspath;
        }
    }
    throw std::runtime_error("Resource not found: " + currentPath.generic_string());
}
```

–¢–∞–∫–∂–µ –Ω–∞–º –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä–∞—è –ø–æ—Å—Ç—Ä–æ—á–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª –∏ –ø–æ–º–µ—â–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ —ç–∫–∑–µ–º–ø–ª—è—Ä `std::string`:

```cpp
std::string CFilesystemUtils::LoadFileAsString(const boost::filesystem::path &path)
{
    const fs::path abspath = GetResourceAbspath(path);

    std::ifstream input;
    input.open(path.native());
    if (!input.is_open())
    {
        throw std::runtime_error("Cannot open for reading: " + path.generic_string());
    }

    std::string text;
    text.reserve(FILE_RESERVE_SIZE);
    input.exceptions(std::ios::badbit);

    std::string line;
    while (std::getline(input, line))
    {
        text.append(line);
        text.append("\n");
    }

    return text;
}
```

–ù–∞–∫–æ–Ω–µ—Ü, –º—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–º –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç IMG_Load –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞ –≤ SDL_Surface. –ß—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–º–∏ –∏ –ø—Ä–æ—Å—Ç–æ —é–Ω–∏–∫–æ–¥–Ω—ã–º–∏ –ø—É—Ç—è–º–∏, –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –ø—É—Ç—å –≤ –æ–¥–Ω–æ–±–∞–π—Ç–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ UTF-8 &mdash; –∏–º–µ–Ω–Ω–æ –≤ —Ç–∞–∫–æ–º –≤–∏–¥–µ SDL –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Å–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º.

```cpp
// –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –ø—É—Ç—å –≤ —Ä–æ–¥–Ω–æ–º –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Ñ–æ—Ä–º–∞—Ç–µ –≤ UTF-8.
//  –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ SDL2 –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—É—Ç–∏ –≤ UTF-8 –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö.
std::string ConvertPathToUtf8(const boost::filesystem::path &path)
{
#ifdef _WIN32
    std::wstring_convert<std::codecvt_utf8<wchar_t>> converter;
    return converter.to_bytes(path.native());
#else // unix-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.
    return path.native();
#endif
}

SDLSurfacePtr CFilesystemUtils::LoadImage(const boost::filesystem::path &path)
{
    const std::string pathUtf8 = ConvertPathToUtf8(path);
    SDLSurfacePtr pSurface(IMG_Load(pathUtf8.c_str()));
    if (!pSurface)
    {
        throw std::runtime_error("Cannot find texture at " + path.generic_string());
    }

	return pSurface;
}
```

–í—ã—à–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö SDLSurfacePtr, –∫–æ—Ç–æ—Ä—ã–π –º—ã –æ–±—ä—è–≤–∏–º –∫–∞–∫ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é unique_ptr –¥–ª—è SDL_Surface:

```cpp
namespace detail
{
struct SDLSurfaceDeleter
{
    void operator()(SDL_Surface *ptr)
    {
        SDL_FreeSurface(ptr);
    }
};
}

using SDLSurfacePtr = std::unique_ptr<SDL_Surface, detail::SDLSurfaceDeleter>;
```

## –ö–ª–∞—Å—Å CTexture2D

–ö–ª–∞—Å—Å –∑–∞–≥—É–∑–∫–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –¥–≤—É–º–µ—Ä–Ω–æ–π —Ç–µ–∫—Å—Ç—É—Ä—ã –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–≤–µ –∑–∞–¥–∞—á–∏:

- –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å RAII –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è OpenGL-–æ–±—ä–µ–∫—Ç–æ–º "—Ç–µ–∫—Å—Ç—É—Ä–∞", –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –≤–∏–¥–µ–æ–¥—Ä–∞–π–≤–µ—Ä –≤—ã–¥–∞—ë—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∏–ø–∞ unsigned
- –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–∞–∫ –ø—Ä–∏–≤—è–∑–∫—É —Ç–µ–∫—Å—Ç—É—Ä—ã –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é OpenGL, —Ç–∞–∫ –∏ –æ—Ç–º–µ–Ω—É —Ä–∞–Ω–µ–µ —Å–æ–≤–µ—Ä—à—ë–Ω–Ω–æ–π –ø—Ä–∏–≤—è–∑–∫–∏

–í OpenGL –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π —Ç–µ–∫—Å—Ç—É—Ä—ã –∫ —Ç–µ–∫—É—â–µ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è [glBindTexture](https://msdn.microsoft.com/en-us/library/windows/desktop/dd318364%28v=vs.85%29.aspx). –ó–∞–º–µ—Ç–∏–º, —á—Ç–æ –≤ –±–æ–ª–µ–µ –ø–æ–∑–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏—è—Ö OpenGL –±—ã–ª–∏ –≤–≤–µ–¥–µ–Ω—ã –±–æ–ª–µ–µ —É–¥–∞—á–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã, –ø–æ–∑–≤–æ–ª—è—é—â–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±–æ–ª–µ–µ –æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç—É—Ä—ã; —ç—Ç–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –∏–º–µ—é—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –º–Ω–æ–≥–∏—Ö —Å–ø–µ—Ü—ç—Ñ—Ñ–µ–∫—Ç–æ–≤, –Ω–æ –Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç –Ω–∞—Å –≤ —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–∏.

```cpp
// –ü—Ä–∏–≤—è–∑–∫–∞ —Ç–µ–∫—Å—Ç—É—Ä—ã —Å –∏–Ω–¥–µ–∫—Å–æ–º m_textureId –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é OpenGL
// –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Ç–µ–∫—Å—Ç—É—Ä–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏
// —Ç–∞–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º
glBindTexture(GL_TEXTURE_2D, m_textureId);

// –û—Ç–≤—è–∑–∫–∞ —Ç–µ–∫—Å—Ç—É—Ä—ã –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è OpenGL, —Ç–µ–ø–µ—Ä—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ OpenGL
// –Ω–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–π —Ç–µ–∫—Å—Ç—É—Ä—ã
glBindTexture(GL_TEXTURE_2D, 0);
```

–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ bind/unbind –≤–ø–æ–ª–Ω–µ –ø—Ä–∏–µ–º–ª–µ–º –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ–≥–æ —Å—Ç–∏–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö, –≥–¥–µ –≤–æ–∑–º–æ–∂–µ–Ω –≤—ã–±—Ä–æ—Å –∏—Å–∫–ª—é—á–µ–Ω–∏–π. –ü–æ—ç—Ç–æ–º—É –º—ã –¥–æ–±–∞–≤–∏–º –∫ –∫–ª–∞—Å—Å—É CTexture2D –º–µ—Ç–æ–¥ DoWhileBinded, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π —Ñ—É–Ω–∫—Ç–æ—Ä –∏ –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π –µ–≥–æ –≤ —Ç–æ—Ç –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ —Ç–µ–∫—Å—Ç—É—Ä–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é OpenGL.

#### Texture2D.h

```cpp
#pragma once
#include <boost/noncopyable.hpp>
#include <boost/scope_exit.hpp>
#include <string>
#include <memory>

class CTexture2D;
using CTexture2DUniquePtr = std::unique_ptr<CTexture2D>;

/// –ö–ª–∞—Å—Å –≤–ª–∞–¥–µ–µ—Ç —Ç–µ–∫—Å—Ç—É—Ä–æ–π —Ç–∏–ø–∞ GL_TEXTURE_2D,
///    —É –∫–æ—Ç–æ—Ä–æ–π –µ—Å—Ç—å –¥–≤–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã "s" –∏ "t",
///    –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å –µ—ë –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É OpenGL
class CTexture2D : private boost::noncopyable
{
public:
    CTexture2D();
    ~CTexture2D();

    void Bind()const;
    static void Unbind();

    template <class TFunction>
    void DoWhileBinded(TFunction && fn)const
    {
        Bind();
        // –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ–º Unbind.
        BOOST_SCOPE_EXIT_ALL(&) {
            Unbind();
        };
        fn();
    }

private:
    unsigned m_textureId = 0;
};
```

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –º–∞–∫—Ä–æ—Å [BOOST_SCOPE_EXIT_ALL](http://www.boost.org/doc/libs/1_52_0/libs/scope_exit/doc/html/BOOST_SCOPE_EXIT_ALL.html), –∫–æ—Ç–æ—Ä—ã–π –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö Boost, –Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π C++11. –ú–∞–∫—Ä–æ—Å —Å–ª—É–∂–∏—Ç —Ö–æ—Ä–æ—à–µ–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ–π –Ω–∞–ø–∏—Å–∞–Ω–∏—é –Ω–µ–±–æ–ª—å—à–∏—Ö RAII-–∫–ª–∞—Å—Å–æ–≤.

–°–æ–∑–¥–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∏ –ø—Ä–∏–≤—è–∑–∫–∞ —Ç–µ–∫—Å—Ç—É—Ä—ã —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è –ø—Ä–æ—Å—Ç–æ:

```cpp
#include "stdafx.h"
#include "Texture2D.h"

CTexture2D::CTexture2D()
{
    glGenTextures(1, &m_textureId);
}

CTexture2D::~CTexture2D()
{
    glDeleteTextures(1, &m_textureId);
}

void CTexture2D::Bind() const
{
    glBindTexture(GL_TEXTURE_2D, m_textureId);
}

void CTexture2D::Unbind()
{
    glBindTexture(GL_TEXTURE_2D, 0);
}
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞–ª–æ–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç—É—Ä—ã

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —Å –Ω–∞–ª–æ–∂–µ–Ω–Ω–æ–π –Ω–∞ –Ω–µ–≥–æ —Ç–µ–∫—Å—Ç—É—Ä–æ–π, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –Ω–∞–ª–æ–∂–µ–Ω–∏—è –¥–≤—É—Ö–º–µ—Ä–Ω–æ–π —Ç–µ–∫—Å—Ç—É—Ä—ã –ø—Ä–∏ –ø–æ–º–æ—â–∏ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ glEnable —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º GL_TEXTURE_2D, –≤—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—ã–π —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã–π –æ–±—ä–µ–∫—Ç –ø—Ä–∏ –ø–æ–º–æ—â–∏ glBindTexure, –∞ –∑–∞—Ç–µ–º

- –ª–∏–±–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å –º–∞—Å—Å–∏–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–∞–∂–¥–æ–π –≤–µ—Ä—à–∏–Ω—ã –ø—Ä–∏–º–∏—Ç–∏–≤–∞, —Å –ø–æ–º–æ—â—å—é [glTexCoordPointer](https://www.opengl.org/sdk/docs/man2/xhtml/glTexCoordPointer.xml)
- –ª–∏–±–æ –∑–∞–¥–∞—Ç—å —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ glBegin/glEnd –¥–ª—è –∫–∞–∂–¥–æ –≤–µ—Ä—à–∏–Ω—ã –æ—Ç–¥–µ–ª—å–Ω–æ —Å –ø–æ–º–æ—â—å—é —Å–µ–º–µ–π—Å—Ç–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π [glTexCoord*](https://www.opengl.org/sdk/docs/man2/xhtml/glTexCoord.xml)
- –ª–∏–±–æ –∏–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º –ø–µ—Ä–µ–¥–∞—Ç—å —ç—Ç–æ—Ç –∞—Ç—Ä–∏–±—É—Ç –¥–ª—è –∫–∞–∂–¥–æ–π –≤–µ—Ä—à–∏–Ω—ã

–¢–µ–∫—Å—Ç—É—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Å–ø–æ—Å–æ–± –Ω–∞–ª–æ–∂–µ–Ω–∏—è –≤—Å–µ–π —Ç–µ–∫—Å—Ç—É—Ä—ã –∏–ª–∏ –µ—ë —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å. –û–±—â–∏–π –ø—Ä–∏–Ω—Ü–∏–ø –ø—Ä–æ–∏–ª–ª—é—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∏–∂–µ:

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è](figures/texture_rect_transform.png)

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è](figures/texture_applyed_to_cube.png)

–¢–µ–∫—Å—Ç—É—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∑–∞–¥–∞—é—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç—É—Ä–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ, –∑–∞–¥–∞—é—â–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç—É—Ä–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –¥–∏–∞–ø–∞–∑–æ–Ω –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –æ—Ç 0 –¥–æ 1.

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è](figures/texture_transforms.png)

–ï—Å—Ç—å —Ä—è–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç—É—Ä—ã

- –æ–±–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ (wrapping), –∑–∞–¥–∞—é—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã [0;1]:
![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è](figures/c3_clamping.png)

- –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç—É—Ä—ã –ø—Ä–∏ –µ—ë –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏ (filtering):
![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è](figures/Anisotropic_filtering_en.png)

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Ç–µ–∫—Å—Ç—É—Ä—ã –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤ —Å—Ç–∞—Ç—å–µ –Ω–∞ [open.gl/textures](https://open.gl/textures). –í —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –º—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

## –ö–ª–∞—Å—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—Å—Ç—É—Ä

–ö–ª–∞—Å—Å CTexture2DLoader –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ç–µ–∫—Å—Ç—É—Ä–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –∏–∑ —Ñ–∞–π–ª–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∏ –∫–∏–¥–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ —Å–ª—É—á–∞–µ –Ω–µ—É–¥–∞—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏. –¢–∞–∫–∂–µ –±—É–¥–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–∏–º–µ–Ω—è–µ–º—ã–µ –∫ —Ç–µ–∫—Å—Ç—É—Ä–µ, –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π.

```cpp
enum class TextureWrapMode
{
	REPEAT,
	CLAMP_TO_EDGE,

	// –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ OpenGL - GL_REPEAT.
	DEFAULT_VALUE = REPEAT,
};

/// –ö–ª–∞—Å—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–µ–∫—Å—Ç—É—Ä—É —Ç–∏–ø–∞ GL_TEXTURE_2D,
///    –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π *.bmp, *.jpg, *.png –∏ –ª—é–±—ã—Ö –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤,
///    —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–æ–¥—É–ª—å SDL_image.
class CTexture2DLoader
{
public:
    CTexture2DUniquePtr Load(const boost::filesystem::path &path);

    void SetWrapMode(TextureWrapMode wrap);
    void SetWrapMode(TextureWrapMode wrapS, TextureWrapMode wrapT);

private:
    TextureWrapMode m_wrapS = TextureWrapMode::DEFAULT_VALUE;
    TextureWrapMode m_wrapT = TextureWrapMode::DEFAULT_VALUE;
};
```

–ú—ã –Ω–∞–ø–∏—à–µ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥ `CUtils::FlipSurfaceVertically`, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø–∏–∫—Å–µ–ª—è–º SDL_Surface –∏ –∑–µ—Ä–∫–∞–ª–∏—Ä—É–µ—Ç –∏—Ö –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Ç–µ–∫—Å—Ç—É—Ä–∞ –Ω–µ –æ–∫–∞–∂–µ—Ç—Å—è –ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–æ–π –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ OpenGL —Å—á–∏—Ç–∞–µ—Ç —Ç–æ—á–∫–æ–π –æ—Ç—Å—á—ë—Ç–∞ –≤ —Ç–µ–∫—Å—Ç—É—Ä–µ –ª–µ–≤—ã–π –Ω–∏–∂–Ω–∏–π —É–≥–æ–ª, –∞ –Ω–µ –ª–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π.

```cpp
void CUtils::FlipSurfaceVertically(SDL_Surface &surface)
{
    const auto rowSize = size_t(surface.w * surface.format->BytesPerPixel);
    std::vector<uint8_t> row(rowSize);

    // –ó–µ—Ä–∫–∞–ª—å–Ω–æ –æ—Ç—Ä–∞–∂–∞–µ–º –ø–∏–∫—Å–µ–ª–∏ –ø–æ –æ—Å–∏ Y,
    //  –µ—Å–ª–∏ —á–∏—Å–ª–æ —Å—Ç—Ä–æ–∫ –ø–∏–∫—Å–µ–ª–µ–π –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –Ω–µ—á—ë—Ç–Ω–æ–µ,
    //  —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç–æ–π.
    for (size_t y = 0, height = size_t(surface.h); y < height / 2; ++y)
    {
        auto *pixels = reinterpret_cast<uint8_t*>(surface.pixels);
        auto *upperRow = pixels + rowSize * y;
        auto *lowerRow = pixels + rowSize * (height - y - 1);
        std::memcpy(row.data(), upperRow, rowSize);
        std::memcpy(upperRow, lowerRow, rowSize);
        std::memcpy(lowerRow, row.data(), rowSize);
    }
}
```

–¢–µ–ø–µ—Ä—å —Ä–µ–∞–ª–∏–∑—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–Ω–∞—á–∞–ª–∞ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å –≤ –≤–∏–¥–µ –º–∞—Ç—Ä–∏—Ü—ã –ø–∏–∫—Å–µ–ª–µ–π, –∞ –∑–∞—Ç–µ–º –∏ –≤ –≤–∏–¥–µ–æ–ø–∞–º—è—Ç—å –≤ –≤–∏–¥–µ —Ç–µ–∫—Å—Ç—É—Ä—ã OpenGL:

```cpp
CTexture2DUniquePtr CTexture2DLoader::Load(const path &path)
{
	SDLSurfacePtr pSurface = CFilesystemUtils::LoadImage(path);

	// –í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—É–¥–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ RGB –∏–ª–∏ RGBA,
	//  –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è –∞–ª—å—Ñ–∞-–∫–∞–Ω–∞–ª–∞ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏.
	const bool hasAlpha = SDL_ISPIXELFORMAT_ALPHA(pSurface->format->format);
	const GLenum pixelFormat = hasAlpha ? GL_RGBA : GL_RGB;
	const uint32_t requiredFormat = hasAlpha
		? SDL_PIXELFORMAT_ABGR8888
		: SDL_PIXELFORMAT_RGB24;
	if (pSurface->format->format != requiredFormat)
	{
		pSurface.reset(SDL_ConvertSurfaceFormat(pSurface.get(), requiredFormat, 0));
	}

	// –í —Å–∏—Å—Ç–µ–º–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç OpenGL –æ—Ç—Å—á—ë—Ç –∏–¥—ë—Ç —Å –Ω–∏–∂–Ω–µ–π –ª–µ–≤–æ–π —Ç–æ—á–∫–∏,
	//  –∞ –Ω–µ —Å –≤–µ—Ä—Ö–Ω–µ–π –ª–µ–≤–æ–π, –ø–æ—ç—Ç–æ–º—É –ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.
	CUtils::FlipSurfaceVertically(*pSurface);

	auto pTexture = std::make_unique<CTexture2D>();
	pTexture->DoWhileBinded([&] {
		glTexImage2D(GL_TEXTURE_2D, 0, GLint(pixelFormat), pSurface->w, pSurface->h,
			0, pixelFormat, GL_UNSIGNED_BYTE, pSurface->pixels);
		glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
		glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
		glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GLint(ConvertEnum(m_wrapS)));
		glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GLint(ConvertEnum(m_wrapT)));
	});

	return pTexture;
}

void CTexture2DLoader::SetWrapMode(TextureWrapMode wrap)
{
	m_wrapS = wrap;
	m_wrapT = wrap;
}

void CTexture2DLoader::SetWrapMode(TextureWrapMode wrapS, TextureWrapMode wrapT)
{
	m_wrapS = wrapS;
	m_wrapT = wrapT;
}
```

## –ù–∞–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç—É—Ä—ã –Ω–∞ –æ–±—ä–µ–º–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã

–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—ä–µ–º–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –≤ OpenGL —Å–≤–æ–¥–∏—Ç—Å—è –≤ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–ª–æ—Å–∫–∏—Ö –≥—Ä–∞–Ω–µ–π, –∞–ø–ø—Ä–æ–∫—Å–∏–º–∏—Ä—É—é—â–∏—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–ª–∏—á–∏–π –æ—Ç –Ω–∞–ª–æ–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç—É—Ä—ã –Ω–∞ –ø–ª–æ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã –Ω–µ—Ç. –û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äì –∑–∞–¥–∞—Ç—å —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–µ—Ä—à–∏–Ω –≥—Ä–∞–Ω–µ–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∂–µ–ª–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤ –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ —Ä–∞—Å—á–µ—Ç —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–ª—è —Å—Ñ–µ—Ä—ã –∏ –∫—É–±–∞, –ø–æ—Å–∫–æ–ª—å–∫—É –¥–ª—è —Ç–∞–∫–∏—Ö —Ñ–∏–≥—É—Ä —Ä–∞—Å—á–µ—Ç —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ. –ü—Ä–∏ –Ω–∞–ª–æ–∂–µ–Ω–∏–∏ —Ç–µ–∫—Å—Ç—É—Ä—ã –Ω–∞ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–µ–Ω –∏–ª–∏ –Ω–µ –¥–∞–µ—Ç –∂–µ–ª–∞–µ–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ü–æ—ç—Ç–æ–º—É –¥–∏–∑–∞–π–Ω–µ—Ä—ã —Ç—Ä–µ—Ö–º–µ—Ä–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –≤—ã–ø–æ–ª–Ω—è—é—Ç –Ω–∞–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç—É—Ä—ã –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º. –î–∞–Ω–Ω–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –ø–æ–ª—É—á–∏–ª–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ UV mapping (U –∏ V ‚Äì —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω–æ–µ –∏–º—è –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω—ã—Ö –æ—Å–µ–π –≤ –¥–≤—É—Ö–º–µ—Ä–Ω–æ–º —Ç–µ–∫—Å—Ç—É—Ä–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ):

UV mapping –Ω–∞–ø—Ä—è–º—É—é —Å–æ—á–µ—Ç–∞–µ—Ç—Å—è —Å UV-–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–µ–π. –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É, –≤–Ω–µ–¥—Ä–∏—Ç—å —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –∫–ª–∞—Å—Å —Å—Ñ–µ—Ä—ã –¥–ª—è –Ω–∞—Å –±—É–¥–µ—Ç –æ—á–µ–Ω—å –ª–µ–≥–∫–æ:

- SVertexP3N –Ω—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å (–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ SVertexP3NT2)
- –≤ —Ñ—É–Ω–∫—Ü–∏–∏ DoWithBindedArrays –Ω–∞–¥–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—è–∑–∫—É GL_TEXTURE_COORD_ARRAY

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ SMeshP3NT3

–ß—Ç–æ–±—ã –æ—Ç–¥–µ–ª–∏—Ç—å –ª–æ–≥–∏–∫—É —Ç—Ä–∏–∞–Ω–≥—É–ª—è—Ü–∏–∏ —Å—Ñ–µ—Ä—ã –æ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–≤–µ–Ω–∏—è –≤–µ—Ä—à–∏–Ω, –æ–ø–∏—à–µ–º –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –ø–∞—Ä–µ H-CPP —Å—Ç—Ä—É–∫—Ç—É—Ä—É SMeshP3NT3. –¢–∞–∫–∏–º –±—É–¥–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫:

```cpp
#pragma once

#include <glm/fwd.hpp>
#include <glm/vec2.hpp>
#include <glm/vec3.hpp>
#include <vector>

enum class MeshType
{
    Triangles,
    TriangleFan,
    TriangleStrip,
};

// –í–µ—Ä—à–∏–Ω–∞ —Å —Ç—Ä—ë—Ö–º–µ—Ä–Ω–æ–π –ø–æ–∑–∏—Ü–∏–µ–π, –Ω–æ—Ä–º–∞–ª—å—é –∏ 2D –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ —Ç–µ–∫—Å—Ç—É—Ä—ã.
struct SVertexP3NT2
{
    glm::vec3 position;
    glm::vec2 texCoord;
    glm::vec3 normal;
};

// –°–µ—Ç–∫–∞ –≤–µ—Ä—à–∏–Ω —Å —Ç—Ä—ë—Ö–º–µ—Ä–Ω–æ–π –ø–æ–∑–∏—Ü–∏–µ–π, –Ω–æ—Ä–º–∞–ª—å—é –∏ 2D –∫–æ–æ–¥–∏–Ω–∞—Ç–∞–º–∏ —Ç–µ–∫—Å—Ç—É—Ä—ã.
struct SMeshP3NT2
{
    std::vector<SVertexP3NT2> m_vertices;
    std::vector<uint32_t> m_indicies;
    MeshType m_meshType = MeshType::Triangles;

    // –û—á–∏—â–∞–µ—Ç –≤–µ—Ä—à–∏–Ω—ã –∏ –∏–Ω–¥–µ–∫—Å—ã, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–∏–ø –ø—Ä–∏–º–∏—Ç–∏–≤–∞.
    void Clear(MeshType meshType);

    // –†–∏—Å—É–µ—Ç —Å–µ—Ç–∫—É –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—è –º–∞—Å—Å–∏–≤—ã –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –≤–µ—Ä—à–∏–Ω.
    void Draw()const;
};
```

–í —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏–≤—è–∑–∞—Ç—å –º–∞—Å—Å–∏–≤—ã –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –≤–µ—Ä—à–∏–Ω, –∞ –∑–∞—Ç–µ–º –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –Ω—É–∂–Ω—É—é –≥—Ä—É–ø–ø—É –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ (–æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∏, –ø–æ–ª–æ—Å—É —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤ –∏–ª–∏ –≤–µ–µ—Ä —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤):

```cpp
#include "stdafx.h"
#include "MeshP3NT2.h"

namespace
{
/// –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –≤–µ—Ä—à–∏–Ω—ã –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é OpenGL,
/// –∑–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞–µ—Ç 'callback'.
template <class T>
void DoWithBindedArrays(const std::vector<SVertexP3NT2> &vertices, T && callback)
{
    // –í–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º vertex array –∏ normal array.
    glEnableClientState(GL_TEXTURE_COORD_ARRAY);
    glEnableClientState(GL_VERTEX_ARRAY);
    glEnableClientState(GL_NORMAL_ARRAY);

    // –í—ã–ø–æ–ª–Ω—è–µ–º –ø—Ä–∏–≤—è–∑–∫—É vertex array –∏ normal array
    const size_t stride = sizeof(SVertexP3NT2);
    glNormalPointer(GL_FLOAT, stride, glm::value_ptr(vertices[0].normal));
    glVertexPointer(3, GL_FLOAT, stride, glm::value_ptr(vertices[0].position));
    glTexCoordPointer(2, GL_FLOAT, stride, glm::value_ptr(vertices[0].texCoord));

    // –í—ã–ø–æ–ª–Ω—è–µ–º –≤–Ω–µ—à–Ω—é—é —Ñ—É–Ω–∫—Ü–∏—é.
    callback();

    // –í—ã–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º vertex array –∏ normal array.
    glDisableClientState(GL_TEXTURE_COORD_ARRAY);
    glDisableClientState(GL_VERTEX_ARRAY);
    glDisableClientState(GL_NORMAL_ARRAY);
}

GLenum GetPrimitiveType(MeshType type)
{
    switch (type)
    {
    case MeshType::Triangles:
        return GL_TRIANGLES;
    case MeshType::TriangleFan:
        return GL_TRIANGLE_FAN;
    case MeshType::TriangleStrip:
        return GL_TRIANGLE_STRIP;
    default:
        throw std::logic_error("Unhandled mesh type");
    }
}
}

void SMeshP3NT2::Clear(MeshType meshType)
{
    m_meshType = meshType;
    m_indicies.clear();
    m_vertices.clear();
}

void SMeshP3NT2::Draw() const
{
    DoWithBindedArrays(m_vertices, [this] {
        GLenum primitive = GetPrimitiveType(m_meshType);
        glDrawElements(primitive, GLsizei(m_indicies.size()),
                       GL_UNSIGNED_INT, m_indicies.data());
    });
}
```

## –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∫–ª–∞—Å—Å CIdentitySphere

–ü–æ—Å–ª–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```cpp
#pragma once

#include "MeshP3NT2.h"
#include "libchapter2.h"

class CIdentitySphere final : public ISceneObject
{
public:
    CIdentitySphere(unsigned slices, unsigned stacks);

    void Update(float) final {}
    void Draw()const final;

private:
    void Tesselate(unsigned slices, unsigned stacks);

    SMeshP3NT2 m_mesh;
};
```

–í –º–µ—Ç–æ–¥–µ Tesselate –Ω–∞–¥–æ –ø–µ—Ä–µ–¥–∞—Ç—å `(1-u,v)` –∫–∞–∫ –¥–≤–µ —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã. –í —ç—Ç–æ–º —Ç—Ä—é–∫–µ –∏ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤—ã–≥–æ–¥–∞ UV-–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–∏: –Ω–∞–º –Ω–µ –Ω–∞–¥–æ –≤—ã—á–∏—Å–ª—è—Ç—å, –∫–∞–∫ –Ω–∞–ª–æ–∂–∏—Ç—å —Ç–µ–∫—Å—Ç—É—Ä—É –Ω–∞ —Ç–µ–ª–æ –≤—Ä–∞—â–µ–Ω–∏—è.

```cpp
#include "stdafx.h"
#include "IdentitySphere.h"
#include <algorithm>

namespace
{
const unsigned MIN_PRECISION = 4;

void CalculateTriangleStripIndicies(std::vector<uint32_t> &indicies,
                                    unsigned columnCount, unsigned rowCount)
{
    indicies.clear();
    indicies.reserve((columnCount - 1) * rowCount * 2);
    // –≤—ã—á–∏—Å–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –≤–µ—Ä—à–∏–Ω.
    for (unsigned ci = 0; ci < columnCount - 1; ++ci)
    {
        if (ci % 2 == 0)
        {
            for (unsigned ri = 0; ri < rowCount; ++ri)
            {
                unsigned index = ci * rowCount + ri;
                indicies.push_back(index + rowCount);
                indicies.push_back(index);
            }
        }
        else
        {
            for (unsigned ri = rowCount - 1; ri < rowCount; --ri)
            {
                unsigned index = ci * rowCount + ri;
                indicies.push_back(index);
                indicies.push_back(index + rowCount);
            }
        }
    }
}

glm::vec3 GetPositionOnSphere(float u, float v)
{
    const float radius = 1.f;
    const float latitude = float(M_PI) * (1.f - v); // ùùÖ‚àô(ùüé.ùüì-ùíó)
    const float longitude = float(2.0 * M_PI) * u; // ùüêùùÖ‚àôùíñ
    const float latitudeRadius = radius * sinf(latitude);

    return { cosf(longitude) * latitudeRadius,
             cosf(latitude) * radius,
             sinf(longitude) * latitudeRadius };
}
}

CIdentitySphere::CIdentitySphere(unsigned slices, unsigned stacks)
{
    Tesselate(slices, stacks);
}

void CIdentitySphere::Draw() const
{
    m_mesh.Draw();
}

void CIdentitySphere::Tesselate(unsigned slices, unsigned stacks)
{
    assert((slices >= MIN_PRECISION) && (stacks >= MIN_PRECISION));

    m_mesh.Clear(MeshType::TriangleStrip);
    m_mesh.m_vertices.reserve(slices * stacks);
    // –≤—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –≤–µ—Ä—à–∏–Ω.
    for (unsigned ci = 0; ci < slices; ++ci)
    {
        const float u = float(ci) / float(slices - 1);
        for (unsigned ri = 0; ri < stacks; ++ri)
        {
            const float v = float(ri) / float(stacks - 1);

            SVertexP3NT2 vertex;
            vertex.position = GetPositionOnSphere(u, v);

            // –ù–æ—Ä–º–∞–ª—å –∫ —Å—Ñ–µ—Ä–µ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä —Ä–∞–¥–∏—É—Å–∞ –∫ –¥–∞–Ω–Ω–æ–π —Ç–æ—á–∫–µ
            // –ü–æ—Å–∫–æ–ª—å–∫—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞ —Ä–∞–≤–Ω—ã 0, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–µ–∫—Ç–æ—Ä–∞ —Ä–∞–¥–∏—É—Å–∞
            // –±—É–¥—É—Ç —Ä–∞–≤–Ω—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º –≤–µ—Ä—à–∏–Ω—ã.
            // –ë–ª–∞–≥–æ–¥–∞—Ä—è —Ä–∞–¥–∏—É—Å—É, —Ä–∞–≤–Ω–æ–º—É 1, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
            vertex.normal = vertex.position;

            // –û–±–µ —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –ø–ª–∞–≤–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å—Å—è –æ—Ç 0 –¥–æ 1,
            // –Ω–∞—Ç—è–≥–∏–≤–∞—è –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–∞ —Ç–µ–ª–æ –≤—Ä–∞—â–µ–Ω–∏—è.
            // –ü—Ä–∏ UV-–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –±—É–¥—É—Ç u –∏ v.
            vertex.texCoord = {1.f - u, v};

            m_mesh.m_vertices.push_back(vertex);
        }
    }

    CalculateTriangleStripIndicies(m_mesh.m_indicies, slices, stacks);
}
```

–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç—É—Ä—É –¥–ª—è —Å—Ñ–µ—Ä—ã –≤ –ø–æ–ª–µ `CWindow::m_pEarthTexture` –º–æ–∂–Ω–æ –≤ –º–µ—Ç–æ–¥–µ OnWindowInit. –í OnDrawWindow –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç—É—Ä—É –ø—Ä–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏–∏—é

```cpp
void CWindow::OnWindowInit(const glm::ivec2 &size)
{
    (void)size;
    SetupOpenGLState();

    CTexture2DLoader loader;
    loader.SetWrapMode(TextureWrapMode::REPEAT);
    m_pEarthTexture = loader.Load(EARTH_TEX_PATH);
}

void CWindow::OnUpdateWindow(float deltaSeconds)
{
    m_camera.Update(deltaSeconds);
    m_decoratedSphere.Update(deltaSeconds);
}

void CWindow::OnDrawWindow(const glm::ivec2 &size)
{
    SetupView(size);

    m_sunlight.Setup();
    m_material.Setup();
    m_pEarthTexture->DoWhileBinded([&] {
        m_decoratedSphere.Draw();
    });
}
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —ç—Ç–∞–ø–∞ –ø–æ–ª—É—á–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

![–°–∫—Ä–∏–Ω—à–æ—Ç](figures/lesson_11_preview_sphere.png)

## –ì–æ—Ç–æ–≤—ã–º —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã–π –∞—Ç–ª–∞—Å –¥–ª—è SkyBox

–î–ª—è –≤—ã–≤–æ–¥–∞ –∫–æ—Ä–æ–±–∫–∏, —Ä–∏—Å—É—é—â–µ–π –æ–∫—Ä—É–∂–∞—é—â—É—é —Å—Ä–µ–¥—É –≤–æ–∫—Ä—É–≥ –∫–∞–º–µ—Ä—ã, –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è](figures/cube_net.png)

–ï—Å–ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–µ–∫—Å—Ç—É—Ä—É, –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å —Ä—è–¥ –ø—Ä–æ–±–ª–µ–º:

- –º–æ–∂–µ—Ç —É—Å–ª–æ–∂–Ω–∏—Ç—å—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞
- –∏–∑-–∑–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç—É—Ä –Ω–∞ –∫–∞–∂–¥–æ–º –∫–∞–¥—Ä–µ –º–æ–∂–µ—Ç —Å–Ω–∏–∑–∏—Ç—å—Å—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã
- –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ OpenGL —Ç—Ä–µ–±—É—é—Ç, —á—Ç–æ–±—ã —à–∏—Ä–∏–Ω–∞ –∏ –≤—ã—Å–æ—Ç–∞ —Ç–µ–∫—Å—Ç—É—Ä—ã –≤—Å–µ–≥–¥–∞ –±—ã–ª–∏ —Å—Ç–µ–ø–µ–Ω—è–º–∏ –¥–≤–æ–π–∫–∏ (2, 4, 8, ..., 512, 1024 –∏ —Ç.–¥.); —Å–æ–±–ª—é–¥–∞—Ç—å —ç—Ç–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—Ä—É—á–Ω—É—é –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ª–æ–∂–Ω–æ

–î–ª—è –æ–±—Ö–æ–¥–∞ —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º –∏–¥–µ—é [—Ç–µ–∫—Å—Ç—É—Ä–Ω–æ–≥–æ –∞—Ç–ª–∞—Å–∞](https://en.wikipedia.org/wiki/Texture_atlas), –ø–æ–∑–≤–æ–ª—è—é—â–µ–≥–æ —Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–ª—É—é —Å–µ—Ä–∏—é –º–µ–ª–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –≠—Ç–∞ –∏–¥–µ—è —Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–∞ –∫–∞–∫ Sprite Sheet, –∏ –æ–Ω–∞ —à–∏—Ä–æ–∫–æ –ø—Ä–∞–∫—Ç–∏–∫—É–µ—Ç—Å—è –≤ –º–∏—Ä–µ Cocos2d-x:

![–ü—Ä–∏–º–µ—Ä](figures/allen_sprite_sheet_x4_by_kirby144.png)

–î–ª—è —É–ø–∞–∫–æ–≤–∫–∏ —Ç–µ–∫—Å—Ç—É—Ä –≤ —Ç–∞–∫–æ–π –∞—Ç–ª–∞—Å –∏ –≤—ã–≤–æ–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É–ø–∞–∫–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö –≤ XML –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–∞-—É–ø–∞–∫–æ–≤—â–∏–∫. –í –ø—Ä–∏–º–µ—Ä–∞—Ö –±—ã–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ñ–æ—Ä–∫ –æ—Ç–∫—Ä—ã—Ç–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã [Cheetah-Texture-Packer](https://github.com/sergey-shambir/Cheetah-Texture-Packer).

–ü–æ–ª—É—á–µ–Ω–Ω—ã–π Texture Atlas –µ—Å—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤ —Ñ–∞–π–ª–∞—Ö `galaxy.plist` –∏ `galaxy.png`. –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Ç–ª–∞—Å–∞ –±—ã–ª –Ω–∞–ø–∏—Å–∞–Ω –∫–ª–∞—Å—Å CTexture2DAtlas, –∞ —Ç–∞–∫–∂–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–ª–µ—å–Ω—ã–π –∫–ª–∞—Å—Å CPropertyListParser, –∫–æ—Ç–æ—Ä—ã–π —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ TinyXML –∑–∞–≥—Ä—É–∂–∞–µ—Ç XML-–æ–ø–∏—Å–∞–Ω–∏–µ —Å–ø—Ä–∞–π—Ç–∞ –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –∞—Ç–ª–∞—Å—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ—Ä–µ–π–º–∞—Ö. –ò–∑—É—á–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —ç—Ç–∏—Ö –∫–ª–∞—Å—Å–æ–≤ –≤—ã –º–æ–∂–µ—Ç–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –∞ –Ω–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞:

```cpp
/// –ö–ª–∞—Å—Å —Ö—Ä–∞–Ω–∏—Ç –∞—Ç–ª–∞—Å —Ç–µ–∫—Å—Ç—É—Ä,
///    –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–∑ —Å–µ–±—è —Å–∫–ª–µ–µ–Ω–Ω—É—é –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ–∫—Å—Ç—É—Ä
///    –µ–¥–∏–Ω—É—é —Ç–µ–∫—Å—Ç—É—Ä—É, –∞ —Ç–∞–∫–∂–µ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —ç—Ç–æ–π
///    —Ç–µ–∫—Å—Ç—É—Ä—ã –Ω–∞ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏ —Å –ø–æ–º–æ—â—å—é —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç.
/// –§–æ—Ä–º–∞—Ç —Ç–µ–∫—Å—Ç—É—Ä —Å–æ–≤–º–µ—Å—Ç–∏–º —Å cocos2d-x, –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω
///    —Å –ø–æ–º–æ—â—å—é github.com/sergey-shambir/Cheetah-Texture-Packer
class CTexture2DAtlas : private boost::noncopyable
{
public:
    CTexture2DAtlas(const boost::filesystem::path &xmlPath,
                    CTexture2DLoader loader = CTexture2DLoader());

    const CTexture2D &GetTexture()const;
    CFloatRect GetFrameRect(const std::string &frameName)const;

private:
    std::unordered_map<std::string, CFloatRect> m_frames;
    CTexture2DUniquePtr m_pTexture;
};
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∫—É–±–∞ –¥–ª—è SkyBox

–ú—ã –æ–±–Ω–æ–≤–∏–º –∫–ª–∞—Å—Å CIdentityCube, —á—Ç–æ–±—ã –ø–æ–∫—Ä—ã—Ç—å –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ Sky Box, –∫–æ—Ç–æ—Ä–æ–º—É –Ω—É–∂–Ω—ã —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞ –≤–µ—Ä—à–∏–Ω–∞—Ö –∫—É–±–∞.

```cpp
#pragma once

#include "MeshP3NT2.h"
#include "libchapter2.h"
#include <vector>
#include <array>

enum class CubeFace
{
    Front = 0,
    Back,
    Top,
    Bottom,
    Left,
    Right,

    NumFaces
};

class CIdentityCube : public ISceneObject
{
public:
    void Update(float) final;
    void Draw()const final;

    void SetFaceTextureRect(CubeFace face, const CFloatRect &rect);

private:
    void Triangulate();

    static const size_t FACES_COUNT = static_cast<size_t>(CubeFace::NumFaces);

    SMeshP3NT2 m_mesh;
    std::array<CFloatRect, FACES_COUNT> m_textureRects;
    bool m_isDirty = true;
};
```

–ü—Ä–∏ –≤—ã–≤–æ–¥–µ –∫—É–±–∞ —Å–ª–µ–¥—É–µ—Ç –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –Ω–∞–∫–ª–∞–¥—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç—É—Ä—ã, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –∏–∑ —à–µ—Å—Ç–∏ —É—á–∞—Å—Ç–∫–æ–≤ –ø–æ–ø–∞–ª –Ω–∞ —Å–≤–æ—é –≥—Ä–∞–Ω—å –∫—É–±–∞, –∏ —á—Ç–æ–±—ã –Ω–∏ –æ–¥–Ω–∞ —Ç–µ–∫—Å—Ç—É—Ä–∞ –Ω–∞ –≥—Ä–∞–Ω–∏ –Ω–µ –æ–∫–∞–∑–∞–ª–∞—Å—å –ø–æ–≤—ë—Ä–Ω—É—Ç–æ–π. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ —à–≤—ã —Ç–µ–∫—Å—Ç—É—Ä –º–µ–∂–¥—É –≥—Ä–∞–Ω—è–º–∏ –Ω–µ –±—É–¥—É—Ç —Å–æ—á–µ—Ç–∞—Ç—å—Å—è, –∫–∞–∫ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –Ω–∏–∂–µ:

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è](figures/lesson_11_texture_seams.png)

–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç—É—Ä—ã, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤ –≤–∏–¥–µ —Ä–∞–∑–≤—ë—Ä—Ç–∫–∏ –∫—É–±–∞, –Ω–∞ –∫—É–±:

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è](figures/skybox_mapping.png)

–ü–æ–ª—å–∑—É—è—Å—å —ç—Ç–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π, –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –µ–¥–∏–Ω–∏—á–Ω–æ–≥–æ –∫—É–±–∞:

```cpp
#include "stdafx.h"
#include "IdentityCube.h"

#include <stdint.h>

namespace
{
struct SCubeFace
{
    uint16_t vertexIndex1;
    uint16_t vertexIndex2;
    uint16_t vertexIndex3;
    uint16_t vertexIndex4;
    uint16_t faceIndex;
};

// –í–µ—Ä—à–∏–Ω—ã –∫—É–±–∞ —Å–ª—É–∂–∞—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–º –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤,
// —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏—Ö –≥—Ä–∞–Ω–∏ –∫—É–±–∞.
const glm::vec3 CUBE_VERTICIES[] = {
    {-1, +1, -1},
    {+1, +1, -1},
    {+1, -1, -1},
    {-1, -1, -1},
    {-1, +1, +1},
    {+1, +1, +1},
    {+1, -1, +1},
    {-1, -1, +1},
};

// –ü—Ä–∏–≤—ã–∫–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 16-–±–∏—Ç–Ω—ã–π unsigned short,
// —á—Ç–æ–±—ã —ç–∫–æ–Ω–æ–º–∏—Ç—å –ø–∞–º—è—Ç—å –Ω–∞ —Ñ–∏–≥—É—Ä–∞—Ö —Å —Ç—ã—Å—è—á–∞–º–∏ –≤–µ—Ä—à–∏–Ω.
const SCubeFace CUBE_FACES[] = {
    {2, 3, 0, 1, static_cast<uint16_t>(CubeFace::Front)},
    {6, 2, 1, 5, static_cast<uint16_t>(CubeFace::Left)},
    {6, 7, 3, 2, static_cast<uint16_t>(CubeFace::Bottom)},
    {3, 7, 4, 0, static_cast<uint16_t>(CubeFace::Right)},
    {1, 0, 4, 5, static_cast<uint16_t>(CubeFace::Top)},
    {5, 4, 7, 6, static_cast<uint16_t>(CubeFace::Back)},
};
}

void CIdentityCube::Update(float)
{
    if (m_isDirty)
    {
        Triangulate();
        m_isDirty = false;
    }
}

void CIdentityCube::Draw() const
{
    m_mesh.Draw();
}

void CIdentityCube::SetFaceTextureRect(CubeFace face, const CFloatRect &rect)
{
    const size_t index = static_cast<size_t>(face);
    m_textureRects[index] = rect;
    m_isDirty = true;
}

void CIdentityCube::Triangulate()
{
    m_mesh.Clear(MeshType::Triangles);
    for (const SCubeFace &face : CUBE_FACES)
    {
        const CFloatRect texRect = m_textureRects[face.faceIndex];
        const glm::vec3 &coord1 = CUBE_VERTICIES[face.vertexIndex1];
        const glm::vec3 &coord2 = CUBE_VERTICIES[face.vertexIndex2];
        const glm::vec3 &coord3 = CUBE_VERTICIES[face.vertexIndex3];
        const glm::vec3 &coord4 = CUBE_VERTICIES[face.vertexIndex4];
        const glm::vec3 normal = glm::normalize(
                    glm::cross(coord2 - coord1, coord3 - coord1));

        const SVertexP3NT2 v1 = { coord1, texRect.GetTopLeft(), normal};
        const SVertexP3NT2 v2 = { coord2, texRect.GetTopRight(), normal};
        const SVertexP3NT2 v3 = { coord3, texRect.GetBottomRight(), normal};
        const SVertexP3NT2 v4 = { coord4, texRect.GetBottomLeft(), normal};

        const uint32_t fromIndex = uint32_t(m_mesh.m_vertices.size());
        m_mesh.m_vertices.push_back(v1);
        m_mesh.m_vertices.push_back(v2);
        m_mesh.m_vertices.push_back(v3);
        m_mesh.m_vertices.push_back(v4);
        m_mesh.m_indicies.push_back(fromIndex + 0);
        m_mesh.m_indicies.push_back(fromIndex + 1);
        m_mesh.m_indicies.push_back(fromIndex + 2);
        m_mesh.m_indicies.push_back(fromIndex + 0);
        m_mesh.m_indicies.push_back(fromIndex + 2);
        m_mesh.m_indicies.push_back(fromIndex + 3);
    }
}
```

## –ö–ª–∞—Å—Å CSkyBox

–î–∞–Ω–Ω—ã–π –∫–ª–∞—Å—Å –Ω–µ –±—É–¥–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º: –æ–Ω –±—É–¥–µ—Ç –∑–Ω–∞—Ç—å –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Ç–µ–∫—Å—Ç—É—Ä–Ω–æ–º –∞—Ç–ª–∞—Å–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è –Ω–∞–ª–æ–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç—É—Ä—ã –Ω–∞ –∫—É–±; —Ç–∞–∫–∂–µ –æ–Ω –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é –º–∞—Ç—Ä–∏—Ü—É –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è-–≤–∏–¥–∞ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –≥—Ä–∞–Ω–µ–π –∫—É–±–∞ –≤–æ–∫—Ä—É–≥ –∫–∞–º–µ—Ä—ã –Ω–∞ —Ä–∞–≤–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø–æ–≤–æ—Ä–æ—Ç–∞ –∏ –ø–æ–ª–æ–∂–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞:

```cpp
#pragma once

#include "IdentityCube.h"
#include "libchapter2.h"
#include <boost/noncopyable.hpp>

class CSkybox final : public ISceneObject
{
public:
    CSkybox();
    void Update(float dt) final;
    void Draw()const final;

private:
    CIdentityCube m_cube;
    CTexture2DAtlas m_atlas;
};
```

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Å–∞ CSkyBox –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```cpp
#include "stdafx.h"
#include "Skybox.h"
#include <stdint.h>

namespace
{
const char TEXTURE_ATLAS[] = "res/galaxy/galaxy.plist";
const std::pair<CubeFace, const char *> FRAME_MAPPING[] = {
    { CubeFace::Front, "galaxy_front.png" },
    { CubeFace::Back, "galaxy_back.png" },
    { CubeFace::Top, "galaxy_top.png" },
    { CubeFace::Bottom, "galaxy_bottom.png" },
    { CubeFace::Left, "galaxy_left.png" },
    { CubeFace::Right, "galaxy_right.png" },
};

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é —Ç–∞–∫, —á—Ç–æ–±—ã —Ä–∏—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ
// –≤ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö –∫–∞–º–µ—Ä—ã, —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Ä–∞—â–µ–Ω–∏—è –∏
// –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∫–∞–º–µ—Ä—ã.
template<class T>
void DoAtCameraPosition(T && callback)
{
    glm::mat4 modelView;
    glGetFloatv(GL_MODELVIEW_MATRIX, glm::value_ptr(modelView));

    // –û–±–Ω—É–ª—è–µ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –º–∞—Ç—Ä–∏—Ü–µ –∞—Ñ–∏–Ω–Ω–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
    modelView[3][0] = 0.f;
    modelView[3][1] = 0.f;
    modelView[3][2] = 0.f;

    glPushMatrix();
    glLoadMatrixf(glm::value_ptr(modelView));
    callback();
    glPopMatrix();
}

CTexture2DLoader MakeTextureLoader()
{
    CTexture2DLoader loader;
    loader.SetWrapMode(TextureWrapMode::CLAMP_TO_EDGE);
    return loader;
}
}

CSkybox::CSkybox()
    : m_atlas(CFilesystemUtils::GetResourceAbspath(TEXTURE_ATLAS),
              MakeTextureLoader())
{
    for (const auto &pair : FRAME_MAPPING)
    {
        CFloatRect texRect = m_atlas.GetFrameRect(pair.second);
        m_cube.SetFaceTextureRect(pair.first, texRect);
    }
}

void CSkybox::Update(float dt)
{
    m_cube.Update(dt);
}

void CSkybox::Draw() const
{
    m_atlas.GetTexture().DoWhileBinded([this] {
        // –ò–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–¥–Ω–∏–µ –∏ –∑–∞–¥–Ω–∏–µ –≥—Ä–∞–Ω–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ
        // –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å SkyBox –º—ã –≤—Å–µ–≥–¥–∞ —Å–º–æ—Ç—Ä–∏–º –∏–∑–Ω—É—Ç—Ä–∏.
        glDisable(GL_LIGHTING);
        glDepthMask(GL_FALSE);
        glFrontFace(GL_CW);
        DoAtCameraPosition([this] {
            m_cube.Draw();
        });
        glFrontFace(GL_CCW);
        glDepthMask(GL_TRUE);
        glEnable(GL_LIGHTING);
    });
}
```

–ö–æ–¥ –º–µ—Ç–æ–¥–∞ CSkyBox::Draw —Ç—Ä–µ–±—É–µ—Ç –ø–æ—è—Å–Ω–µ–Ω–∏–π.

–í–æ-–ø–µ—Ä–≤—ã—Ö, —Ä–∏—Å–æ–≤–∞–Ω–∏–µ –∫—É–±–∞ –º—ã –±—É–¥–µ–º –≤—ã–ø–æ–ª–Ω—è—Ç—å, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–∫–ª—é—á–∏–≤ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—é –±—É—Ñ–µ—Ä–∞ –≥–ª—É–±–∏–Ω—ã –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ñ—É–Ω–∫—Ü–∏–∏ glDepthMask(GL_FALSE) –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–º —Ç–µ—Å—Ç–µ –≥–ª—É–±–∏–Ω—ã. –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞ –≥–ª—É–±–∏–Ω—ã –ø–æ—Å–ª–µ —Ä–∏—Å–æ–≤–∞–Ω–∏—è sky box –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º, –ø—Ä–∏ —ç—Ç–æ–º –≤—Å–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∫—É–±–∞ –ø—Ä–æ–π–¥—É—Ç —Ç–µ—Å—Ç –≥–ª—É–±–∏–Ω—ã. –ü–æ —ç—Ç–æ–π –∂–µ –ø—Ä–∏—á–∏–Ω–µ sky box –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω –ø–µ—Ä–≤—ã–º, —á—Ç–æ–±—ã –Ω–µ —Å—Ç–µ—Ä–µ—Ç—å –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω–Ω—ã–µ –¥–æ –Ω–µ–≥–æ –æ–±—ä–µ–∫—Ç—ã.

–í–æ-–≤—Ç–æ—Ä—ã—Ö, —Ü–µ–Ω—Ç—Ä –∫—É–±–∞ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Ç–æ—á–∫–µ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –∫–∞–∫–æ–π –±—ã –º—ã —Ä–∞–∑–º–µ—Ä —Å—Ç–æ—Ä–æ–Ω—ã –∫—É–±–∞ –Ω–∏ –≤—ã–±—Ä–∞–ª–∏, –∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ –±—É–¥–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –¥–ª–∏–Ω—ã —Å—Ç–æ—Ä–æ–Ω—ã –∫—É–±–∞. –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–∏–≤—è–∑–∞—Ç—å —Ç–æ—á–∫—É –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∫ —Ç–æ—á–∫–µ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –Ω—É–ª—è–º–∏ –ø–µ—Ä–≤—ã–µ —Ç—Ä–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ —á–µ—Ç–≤–µ—Ä—Ç–æ–º —Å—Ç–æ–ª–±—Ü–µ –º–∞—Ç—Ä–∏—Ü—ã –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è-–≤–∏–¥–∞.

–í-—Ç—Ä–µ—Ç—å–∏—Ö, –∑–¥–µ—Å—å –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∂–∏–º –æ–±–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç GL_CLAMP_TO_EDGE. –ï–≥–æ —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–æ–∏–ª–ª—é—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∏–∂–µ:

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è](figures/c3_clamping.png)

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–í—ã –º–æ–∂–µ—Ç–µ –≤–∑—è—Ç—å [–ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∫ —Å—Ç–∞—Ç—å–µ –Ω–∞ github](https://github.com/PS-Group/cg_course_examples/tree/master/chapter_2/lesson_11). –ê –≤–æ—Ç —Ç–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –æ–∫–Ω–æ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

![–°–∫—Ä–∏–Ω—à–æ—Ç](figures/lesson_11_preview.png)

## –°—Å—ã–ª–∫–∏

- [–°—Ç–∞—Ç—å—è –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –Ω–∞–ª–æ–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç—É—Ä (opengl-tutorial.org)](http://www.opengl-tutorial.org/ru/beginners-tutorials/tutorial-5-a-textured-cube/)
